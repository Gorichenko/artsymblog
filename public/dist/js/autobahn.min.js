window.define||(window.define=function(e){try{delete window.define}catch(e){window.define=void 0}window.when=e()},window.define.amd={}),function(o){var t;o||(o=window.console={log:function(e,n,o,t,r){},info:function(e,n,o,t,r){},warn:function(e,n,o,t,r){},error:function(e,n,o,t,r){}}),Function.prototype.bind||(Function.prototype.bind=function(e){var n=this,o=Array.prototype.slice.call(arguments,1);return function(){return n.apply(e,Array.prototype.concat.apply(o,arguments))}}),"object"==typeof o.log&&(o.log=Function.prototype.call.bind(o.log,o),o.info=Function.prototype.call.bind(o.info,o),o.warn=Function.prototype.call.bind(o.warn,o),o.error=Function.prototype.call.bind(o.error,o)),"group"in o||(o.group=function(e){o.info("\n--- "+e+" ---\n")}),"groupEnd"in o||(o.groupEnd=function(){o.log("\n")}),"time"in o||(t={},o.time=function(e){t[e]=(new Date).getTime()},o.timeEnd=function(e){var n=(new Date).getTime();o.info(e+": "+(e in t?n-t[e]:0)+"ms")})}(window.console),("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)})(function(e){function d(e,n,o,t){return(e instanceof f?e:s(e)).then(n,o,t)}function u(e){return new f(e,A.PromiseStatus&&A.PromiseStatus())}function f(e,t){function n(e){if(c){var o=c;c=N,h(function(){var n;s=function(e,n){if(n===e)return new l(new TypeError);if(n instanceof f)return n;try{var o=n===Object(n)&&n.then;return"function"==typeof o?(t=o,r=n,u(function(e,n){C(t,r,e,n)})):new a(n)}catch(e){return new l(e)}var t,r}(r,e),t&&(n=t,s.then(function(){n.fulfilled()},function(e){n.rejected(e)})),i(o,s)})}}function o(e){n(new l(e))}var r,s,c=[];(r=this)._status=t,this.inspect=function(){return s?s.inspect():{state:"pending"}},this._when=function(n,o,t,r,i){function e(e){e._when(n,o,t,r,i)}c?c.push(e):h(function(){e(s)})};try{e(n,o,function(e){if(c){var n=c;h(function(){i(n,new p(e))})}})}catch(e){o(e)}}function s(n){return u(function(e){e(n)})}function i(e,n){for(var o=0;o<e.length;o++)e[o](n)}function a(e){this.value=e}function l(e){this.value=e}function p(e){this.value=e}function n(e){return e&&"function"==typeof e.then}function r(e,h,n,o,t){return d(e,function(_){return u(function(n,o,e){function t(e){l(e)}function r(e){a(e)}var i,s,c,u,a,l,f,p;if(f=_.length>>>0,i=Math.max(0,Math.min(h,f)),c=[],s=f-i+1,u=[],i)for(l=function(e){u.push(e),--s||(a=l=b,o(u))},a=function(e){c.push(e),--i||(a=l=b,n(c))},p=0;p<f;++p)p in _&&d(_[p],r,t,e);else n(c)}).then(n,o,t)})}function o(e,n,o,t){return c(e,b).then(n,o,t)}function c(e,a,l){return d(e,function(u){return new f(function(o,t,r){function e(e,n){d(e,a,l).then(function(e){i[n]=e,--s||o(i)},t,r)}var i,n,s,c;if(s=n=u.length>>>0,i=[],s)for(c=0;c<n;c++)c in u?e(u[c],c):--s;else o(i)})})}function t(e){return{state:"fulfilled",value:e}}function _(e){return{state:"rejected",reason:e}}function h(e){1===x.push(e)&&O(g)}function g(){i(x),x=[]}function b(e){return e}function E(e){throw"function"==typeof A.reportUnhandled?A.reportUnhandled():h(function(){throw e}),e}var w,y,S,v,C,O,x,A,m,N,k,I,M,T;if(d.promise=u,d.resolve=s,d.reject=function(e){return d(e,function(e){return new l(e)})},d.defer=function(){var e,r,i;return(e={promise:N,resolve:N,reject:N,notify:N,resolver:{resolve:N,reject:N,notify:N}}).promise=r=u(function(n,o,t){e.resolve=e.resolver.resolve=function(e){return i?s(e):(i=!0,n(e),r)},e.reject=e.resolver.reject=function(e){return i?s(new l(e)):(i=!0,o(e),r)},e.notify=e.resolver.notify=function(e){return t(e),e}}),e},d.join=function(){return c(arguments,b)},d.all=o,d.map=function(e,n){return c(e,n)},d.reduce=function(e,i){var n=C(v,arguments,1);return d(e,function(e){var r;return r=e.length,n[0]=function(e,o,t){return d(e,function(n){return d(o,function(e){return i(n,e,t,r)})})},S.apply(e,n)})},d.settle=function(e){return c(e,t,_)},d.any=function(e,n,o,t){return r(e,1,function(e){return n?n(e[0]):e[0]},o,t)},d.some=r,d.isPromise=n,d.isPromiseLike=n,(w=f.prototype).then=function(t,r,i){var s=this;return new f(function(e,n,o){s._when(e,o,t,r,i)},this._status&&this._status.observed())},w.catch=w.otherwise=function(e){return this.then(N,e)},w.finally=w.ensure=function(e){function n(){return s(e())}return"function"==typeof e?this.then(n,n).yield(this):this},w.done=function(e,n){this.then(e,n).catch(E)},w.yield=function(e){return this.then(function(){return e})},w.tap=function(e){return this.then(e).yield(this)},w.spread=function(n){return this.then(function(e){return o(e,function(e){return n.apply(N,e)})})},w.always=function(e,n){return this.then(e,e,n)},y=Object.create||function(e){function n(){}return n.prototype=e,new n},(a.prototype=y(w)).inspect=function(){return t(this.value)},a.prototype._when=function(n,e,o){try{n("function"==typeof o?o(this.value):this.value)}catch(e){n(new l(e))}},(l.prototype=y(w)).inspect=function(){return _(this.value)},l.prototype._when=function(n,e,o,t){try{n("function"==typeof t?t(this.value):this)}catch(e){n(new l(e))}},(p.prototype=y(w))._when=function(e,n,o,t,r){try{n("function"==typeof r?r(this.value):this.value)}catch(e){n(e)}},x=[],A="undefined"!=typeof console?console:d,"object"==typeof process&&process.nextTick)O=process.nextTick;else if(w="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)k=document,I=w,M=g,T=k.createElement("div"),new I(M).observe(T,{attributes:!0}),O=function(){T.setAttribute("x","x")};else try{O=e("vertx").runOnLoop||e("vertx").runOnContext}catch(e){m=setTimeout,O=function(e){m(e,0)}}return w=(e=Function.prototype).call,C=e.bind?w.bind(w):function(e,n){return e.apply(n,v.call(arguments,2))},v=(e=[]).slice,S=e.reduce||function(e){var n,o,t,r,i;if(i=0,r=(n=Object(this)).length>>>0,(o=arguments).length<=1)for(;;){if(i in n){t=n[i++];break}if(++i>=r)throw new TypeError}else t=o[1];for(;i<r;++i)i in n&&(t=e(t,n[i],i,n));return t},d});var CryptoJS=CryptoJS||function(c,e){var n={},o=n.lib={},t=o.Base=function(){function o(){}return{extend:function(e){o.prototype=this;var n=new o;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),(n.init.prototype=n).$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=o.WordArray=t.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=null!=n?n:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var n=this.words,o=e.words,t=this.sigBytes;if(e=e.sigBytes,this.clamp(),t%4)for(var r=0;r<e;r++)n[t+r>>>2]|=(o[r>>>2]>>>24-r%4*8&255)<<24-(t+r)%4*8;else if(65535<o.length)for(r=0;r<e;r+=4)n[t+r>>>2]=o[r>>>2];else n.push.apply(n,o);return this.sigBytes+=e,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=c.ceil(n/4)},clone:function(){var e=t.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var n=[],o=0;o<e;o+=4)n.push(4294967296*c.random()|0);return new u.init(n,e)}}),r=n.enc={},i=r.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var o=[],t=0;t<e;t++){var r=n[t>>>2]>>>24-t%4*8&255;o.push((r>>>4).toString(16)),o.push((15&r).toString(16))}return o.join("")},parse:function(e){for(var n=e.length,o=[],t=0;t<n;t+=2)o[t>>>3]|=parseInt(e.substr(t,2),16)<<24-t%8*4;return new u.init(o,n/2)}},s=r.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var o=[],t=0;t<e;t++)o.push(String.fromCharCode(n[t>>>2]>>>24-t%4*8&255));return o.join("")},parse:function(e){for(var n=e.length,o=[],t=0;t<n;t++)o[t>>>2]|=(255&e.charCodeAt(t))<<24-t%4*8;return new u.init(o,n)}},a=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=a.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var n=this._data,o=n.words,t=n.sigBytes,r=this.blockSize,i=t/(4*r);if(e=(i=e?c.ceil(i):c.max((0|i)-this._minBufferSize,0))*r,t=c.min(4*e,t),e){for(var s=0;s<e;s+=r)this._doProcessBlock(o,s);s=o.splice(0,e),n.sigBytes-=t}return new u.init(s,t)},clone:function(){var e=t.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=l.extend({cfg:t.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(o){return function(e,n){return new o.init(n).finalize(e)}},_createHmacHelper:function(o){return function(e,n){return new f.HMAC.init(o,n).finalize(e)}}});var f=n.algo={};return n}(Math);!function(){var e=CryptoJS,u=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,o=e.sigBytes,t=this._map;e.clamp(),e=[];for(var r=0;r<o;r+=3)for(var i=(n[r>>>2]>>>24-r%4*8&255)<<16|(n[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|n[r+2>>>2]>>>24-(r+2)%4*8&255,s=0;s<4&&r+.75*s<o;s++)e.push(t.charAt(i>>>6*(3-s)&63));if(n=t.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var n=e.length,o=this._map;(t=o.charAt(64))&&(-1!=(t=e.indexOf(t))&&(n=t));for(var t=[],r=0,i=0;i<n;i++)if(i%4){var s=o.indexOf(e.charAt(i-1))<<i%4*2,c=o.indexOf(e.charAt(i))>>>6-i%4*2;t[r>>>2]|=(s|c)<<24-r%4*8,r++}return u.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var e=CryptoJS,a=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=a.parse(n));var o=e.blockSize,t=4*o;n.sigBytes>t&&(n=e.finalize(n)),n.clamp();for(var r=this._oKey=n.clone(),i=this._iKey=n.clone(),s=r.words,c=i.words,u=0;u<o;u++)s[u]^=1549556828,c[u]^=909522486;r.sigBytes=i.sigBytes=t,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(r){var e=CryptoJS,n=(t=e.lib).WordArray,o=t.Hasher,t=e.algo,i=[],h=[];!function(){function e(e){for(var n=r.sqrt(e),o=2;o<=n;o++)if(!(e%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,t=0;t<64;)e(o)&&(t<8&&(i[t]=n(r.pow(o,.5))),h[t]=n(r.pow(o,1/3)),t++),o++}();var d=[];t=t.SHA256=o.extend({_doReset:function(){this._hash=new n.init(i.slice(0))},_doProcessBlock:function(e,n){for(var o=this._hash.words,t=o[0],r=o[1],i=o[2],s=o[3],c=o[4],u=o[5],a=o[6],l=o[7],f=0;f<64;f++){if(f<16)d[f]=0|e[n+f];else{var p=d[f-15],_=d[f-2];d[f]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[f-7]+((_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10)+d[f-16]}p=l+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&a)+h[f]+d[f],_=((t<<30|t>>>2)^(t<<19|t>>>13)^(t<<10|t>>>22))+(t&r^t&i^r&i),l=a,a=u,u=c,c=s+p|0,s=i,i=r,r=t,t=p+_|0}o[0]=o[0]+t|0,o[1]=o[1]+r|0,o[2]=o[2]+i|0,o[3]=o[3]+s|0,o[4]=o[4]+c|0,o[5]=o[5]+u|0,o[6]=o[6]+a|0,o[7]=o[7]+l|0},_doFinalize:function(){var e=this._data,n=e.words,o=8*this._nDataBytes,t=8*e.sigBytes;return n[t>>>5]|=128<<24-t%32,n[14+(t+64>>>9<<4)]=r.floor(o/4294967296),n[15+(t+64>>>9<<4)]=o,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=o._createHelper(t),e.HmacSHA256=o._createHmacHelper(t)}(Math),function(){var e,n=CryptoJS,o=(e=n.lib).Base,g=e.WordArray,b=(e=n.algo).HMAC,t=e.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,n){var o=this.cfg,t=b.create(o.hasher,e),r=g.create(),i=g.create([1]),s=r.words,c=i.words,u=o.keySize;for(o=o.iterations;s.length<u;){var a=t.update(n).finalize(i);t.reset();for(var l=a.words,f=l.length,p=a,_=1;_<o;_++){p=t.finalize(p),t.reset();for(var h=p.words,d=0;d<f;d++)l[d]^=h[d]}r.concat(a),c[0]++}return r.sigBytes=4*u,r}});n.PBKDF2=function(e,n,o){return t.create(o).compute(e,n)}}();var AUTOBAHNJS_VERSION="0.8.2",global=this;!function(n,o){"function"==typeof define&&define.amd?define(["when"],function(e){return n.ab=o(n,e)}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=o(n,n.when)):n.ab=o(n,n.when)}(global,function(t,e){var l={_version:AUTOBAHNJS_VERSION};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var n=Object(this),o=n.length>>>0;if(0===o)return-1;var t=0;if(0<arguments.length&&((t=Number(arguments[1]))!=t?t=0:0!==t&&1/0!==t&&-1/0!==t&&(t=(0<t||-1)*Math.floor(Math.abs(t)))),o<=t)return-1;for(t=0<=t?t:Math.max(o-Math.abs(t),0);t<o;t++)if(t in n&&n[t]===e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,n){var o,t;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("[object Function]"!=={}.toString.call(e))throw new TypeError(e+" is not a function");for(n&&(o=n),t=0;t<i;){var s;t in r&&(s=r[t],e.call(o,s,t,r)),t++}}),l._sliceUserAgent=function(e,n,o){var t=[],r=navigator.userAgent;for(e=r.indexOf(e),(n=r.indexOf(n,e))<0&&(n=r.length),r=(o=r.slice(e,n).split(o))[1].split("."),n=0;n<r.length;++n)t.push(parseInt(r[n],10));return{name:o[0],version:t}},l.getBrowser=function(){var e=navigator.userAgent;return-1<e.indexOf("Chrome")?l._sliceUserAgent("Chrome"," ","/"):-1<e.indexOf("Safari")?l._sliceUserAgent("Safari"," ","/"):-1<e.indexOf("Firefox")?l._sliceUserAgent("Firefox"," ","/"):-1<e.indexOf("MSIE")?l._sliceUserAgent("MSIE",";"," "):null},l.getServerUrl=function(e,n){return"file:"===t.location.protocol?n||"ws://127.0.0.1/ws":("https:"===t.location.protocol?"wss://":"ws://")+t.location.hostname+(""!==t.location.port?":"+t.location.port:"")+"/"+(e||"ws")},l.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",l.deriveKey=function(e,n){return n&&n.salt?CryptoJS.PBKDF2(e,n.salt,{keySize:(n.keylen||32)/4,iterations:n.iterations||1e4,hasher:CryptoJS.algo.SHA256}).toString(CryptoJS.enc.Base64):e},l._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l._idlen=16,l._subprotocol="wamp",l._newid=function(){for(var e="",n=0;n<l._idlen;n+=1)e+=l._idchars.charAt(Math.floor(Math.random()*l._idchars.length));return e},l._newidFast=function(){return Math.random().toString(36)},l.log=function(){if(1<arguments.length){console.group("Log Item");for(var e=0;e<arguments.length;e+=1)console.log(arguments[e]);console.groupEnd()}else console.log(arguments[0])},l._debugrpc=!1,l._debugpubsub=!1,l._debugws=!1,l._debugconnect=!1,l.debug=function(e,n,o){if(!("console"in t))throw"browser does not support console object";l._debugrpc=e,l._debugpubsub=e,l._debugws=n,l._debugconnect=o},l.version=function(){return l._version},l.PrefixMap=function(){this._index={},this._rindex={}},l.PrefixMap.prototype.get=function(e){return this._index[e]},l.PrefixMap.prototype.set=function(e,n){this._index[e]=n,this._rindex[n]=e},l.PrefixMap.prototype.setDefault=function(e){this._index[""]=e,this._rindex[e]=""},l.PrefixMap.prototype.remove=function(e){var n=this._index[e];n&&(delete this._index[e],delete this._rindex[n])},l.PrefixMap.prototype.resolve=function(e,n){var o=e.indexOf(":");if(0<=o){var t=e.substring(0,o);if(this._index[t])return this._index[t]+e.substring(o+1)}return!0===n?e:null},l.PrefixMap.prototype.shrink=function(e,n){for(var o=e.length;0<o;o-=1){var t=e.substring(0,o);if(t=this._rindex[t])return t+":"+e.substring(o)}return!0===n?e:null},l._MESSAGE_TYPEID_WELCOME=0,l._MESSAGE_TYPEID_PREFIX=1,l._MESSAGE_TYPEID_CALL=2,l._MESSAGE_TYPEID_CALL_RESULT=3,l._MESSAGE_TYPEID_CALL_ERROR=4,l._MESSAGE_TYPEID_SUBSCRIBE=5,l._MESSAGE_TYPEID_UNSUBSCRIBE=6,l._MESSAGE_TYPEID_PUBLISH=7,l._MESSAGE_TYPEID_EVENT=8,l.CONNECTION_CLOSED=0,l.CONNECTION_LOST=1,l.CONNECTION_RETRIES_EXCEEDED=2,l.CONNECTION_UNREACHABLE=3,l.CONNECTION_UNSUPPORTED=4,l.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,l.CONNECTION_LOST_SCHEDULED_RECONNECT=6,l.Deferred=e.defer,l._construct=function(e,n){return"WebSocket"in t?n?new WebSocket(e,n):new WebSocket(e):"MozWebSocket"in t?n?new MozWebSocket(e,n):new MozWebSocket(e):null},l.Session=function(e,n,o,t){var a=this;if(a._wsuri=e,a._options=t,a._websocket_onopen=n,a._websocket_onclose=o,a._websocket=null,a._websocket_connected=!1,a._session_id=null,a._wamp_version=null,a._server=null,a._calls={},a._subscriptions={},a._prefixes=new l.PrefixMap,a._txcnt=0,a._rxcnt=0,a._websocket=a._options&&a._options.skipSubprotocolAnnounce?l._construct(a._wsuri):l._construct(a._wsuri,[l._subprotocol]),!a._websocket){if(void 0!==o)return void o(l.CONNECTION_UNSUPPORTED);throw l.browserNotSupportedMessage}a._websocket.onmessage=function(e){if(l._debugws&&(a._rxcnt+=1,console.group("WS Receive"),console.info(a._wsuri+"  ["+a._session_id+"]"),console.log(a._rxcnt),console.log(e.data),console.groupEnd()),(e=JSON.parse(e.data))[1]in a._calls){if(e[0]===l._MESSAGE_TYPEID_CALL_RESULT){var n=a._calls[e[1]],o=e[2];if(l._debugrpc&&void 0!==n._ab_callobj){console.group("WAMP Call",n._ab_callobj[2]),console.timeEnd(n._ab_tid),console.group("Arguments");for(var t=3;t<n._ab_callobj.length;t+=1){var r=n._ab_callobj[t];if(void 0===r)break;console.log(r)}console.groupEnd(),console.group("Result"),console.log(o),console.groupEnd(),console.groupEnd()}n.resolve(o)}else if(e[0]===l._MESSAGE_TYPEID_CALL_ERROR){if(n=a._calls[e[1]],o=e[2],t=e[3],r=e[4],l._debugrpc&&void 0!==n._ab_callobj){console.group("WAMP Call",n._ab_callobj[2]),console.timeEnd(n._ab_tid),console.group("Arguments");for(var i=3;i<n._ab_callobj.length;i+=1){var s=n._ab_callobj[i];if(void 0===s)break;console.log(s)}console.groupEnd(),console.group("Error"),console.log(o),console.log(t),void 0!==r&&console.log(r),console.groupEnd(),console.groupEnd()}void 0!==r?n.reject({uri:o,desc:t,detail:r}):n.reject({uri:o,desc:t})}delete a._calls[e[1]]}else if(e[0]===l._MESSAGE_TYPEID_EVENT){if((n=a._prefixes.resolve(e[1],!0))in a._subscriptions){var c=e[1],u=e[2];l._debugpubsub&&(console.group("WAMP Event"),console.info(a._wsuri+"  ["+a._session_id+"]"),console.log(c),console.log(u),console.groupEnd()),a._subscriptions[n].forEach(function(e){e(c,u)})}}else if(e[0]===l._MESSAGE_TYPEID_WELCOME){if(null!==a._session_id)throw"protocol error (welcome message received more than once)";a._session_id=e[1],a._wamp_version=e[2],a._server=e[3],(l._debugrpc||l._debugpubsub)&&(console.group("WAMP Welcome"),console.info(a._wsuri+"  ["+a._session_id+"]"),console.log(a._wamp_version),console.log(a._server),console.groupEnd()),null!==a._websocket_onopen&&a._websocket_onopen()}},a._websocket.onopen=function(e){if(a._websocket.protocol!==l._subprotocol)if(void 0===a._websocket.protocol)l._debugws&&(console.group("WS Warning"),console.info(a._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!a._options||!a._options.skipSubprotocolCheck)throw a._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+a._websocket.protocol+"' !)";l._debugws&&(console.group("WS Warning"),console.info(a._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(a._websocket.protocol),console.groupEnd())}l._debugws&&(console.group("WAMP Connect"),console.info(a._wsuri),console.log(a._websocket.protocol),console.groupEnd()),a._websocket_connected=!0},a._websocket.onerror=function(e){},a._websocket.onclose=function(e){l._debugws&&(a._websocket_connected?console.log("Autobahn connection to "+a._wsuri+" lost (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+")."):console.log("Autobahn could not connect to "+a._wsuri+" (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+").")),void 0!==a._websocket_onclose&&(a._websocket_connected?e.wasClean?a._websocket_onclose(l.CONNECTION_CLOSED,"WS-"+e.code+": "+e.reason):a._websocket_onclose(l.CONNECTION_LOST):a._websocket_onclose(l.CONNECTION_UNREACHABLE)),a._websocket_connected=!1,a._wsuri=null,a._websocket_onopen=null,a._websocket_onclose=null,a._websocket=null},a.log=function(){a._options&&"sessionIdent"in a._options?console.group("WAMP Session '"+a._options.sessionIdent+"' ["+a._session_id+"]"):console.group("WAMP Session ["+a._session_id+"]");for(var e=0;e<arguments.length;++e)console.log(arguments[e]);console.groupEnd()}},l.Session.prototype._send=function(e){if(!this._websocket_connected)throw"Autobahn not connected";switch(!0){case t.Prototype&&void 0===top.root.__prototype_deleted:case"function"==typeof e.toJSON:e=e.toJSON();break;default:e=JSON.stringify(e)}this._websocket.send(e),this._txcnt+=1,l._debugws&&(console.group("WS Send"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(this._txcnt),console.log(e),console.groupEnd())},l.Session.prototype.close=function(){this._websocket_connected&&this._websocket.close()},l.Session.prototype.sessionid=function(){return this._session_id},l.Session.prototype.wsuri=function(){return this._wsuri},l.Session.prototype.shrink=function(e,n){return void 0===n&&(n=!0),this._prefixes.shrink(e,n)},l.Session.prototype.resolve=function(e,n){return void 0===n&&(n=!0),this._prefixes.resolve(e,n)},l.Session.prototype.prefix=function(e,n){this._prefixes.set(e,n),(l._debugrpc||l._debugpubsub)&&(console.group("WAMP Prefix"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(e),console.log(n),console.groupEnd()),this._send([l._MESSAGE_TYPEID_PREFIX,e,n])},l.Session.prototype.call=function(){for(var e,n=new l.Deferred;(e=l._newidFast())in this._calls;);this._calls[e]=n;for(var o=this._prefixes.shrink(arguments[0],!0),t=(o=[l._MESSAGE_TYPEID_CALL,e,o],1);t<arguments.length;t+=1)o.push(arguments[t]);return this._send(o),l._debugrpc&&(n._ab_callobj=o,n._ab_tid=this._wsuri+"  ["+this._session_id+"]["+e+"]",console.time(n._ab_tid),console.info()),n.promise.then?n.promise:n},l.Session.prototype.subscribe=function(e,n){var o=this._prefixes.resolve(e,!0);if(o in this._subscriptions||(l._debugpubsub&&(console.group("WAMP Subscribe"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(e),console.log(n),console.groupEnd()),this._send([l._MESSAGE_TYPEID_SUBSCRIBE,e]),this._subscriptions[o]=[]),-1!==this._subscriptions[o].indexOf(n))throw"callback "+n+" already subscribed for topic "+o;this._subscriptions[o].push(n)},l.Session.prototype.unsubscribe=function(e,n){var o,t=this._prefixes.resolve(e,!0);if(!(t in this._subscriptions))throw"not subscribed to topic "+t;if(void 0!==n){var r=this._subscriptions[t].indexOf(n);if(-1===r)throw"no callback "+n+" subscribed on topic "+t;o=n,this._subscriptions[t].splice(r,1)}else o=this._subscriptions[t].slice(),this._subscriptions[t]=[];0===this._subscriptions[t].length&&(delete this._subscriptions[t],l._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(e),console.log(o),console.groupEnd()),this._send([l._MESSAGE_TYPEID_UNSUBSCRIBE,e]))},l.Session.prototype.publish=function(){var e=arguments[0],n=arguments[1],o=null,t=null,r=null,i=null;if(3<arguments.length){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";t=arguments[2],r=arguments[3],i=[l._MESSAGE_TYPEID_PUBLISH,e,n,t,r]}else if(2<arguments.length)if("boolean"==typeof arguments[2])o=arguments[2],i=[l._MESSAGE_TYPEID_PUBLISH,e,n,o];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";t=arguments[2],i=[l._MESSAGE_TYPEID_PUBLISH,e,n,t]}else i=[l._MESSAGE_TYPEID_PUBLISH,e,n];l._debugpubsub&&(console.group("WAMP Publish"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(e),console.log(n),null!==o?console.log(o):null!==t&&(console.log(t),null!==r&&console.log(r)),console.groupEnd()),this._send(i)},l.Session.prototype.authreq=function(e,n){return this.call("http://api.wamp.ws/procedure#authreq",e,n)},l.Session.prototype.authsign=function(e,n){return n||(n=""),CryptoJS.HmacSHA256(e,n).toString(CryptoJS.enc.Base64)},l.Session.prototype.auth=function(e){return this.call("http://api.wamp.ws/procedure#auth",e)},l._connect=function(o){var e=new l.Session(o.wsuri,function(){o.connects+=1,o.retryCount=0,o.onConnect(e)},function(e,n){switch(e){case l.CONNECTION_CLOSED:o.onHangup(e,"Connection was closed properly ["+n+"]");break;case l.CONNECTION_UNSUPPORTED:o.onHangup(e,"Browser does not support WebSocket.");break;case l.CONNECTION_UNREACHABLE:o.retryCount+=1,0===o.connects?o.onHangup(e,"Connection could not be established."):o.retryCount<=o.options.maxRetries?o.onHangup(l.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+o.options.retryDelay/1e3+" second(s) - attempt "+o.retryCount+" of "+o.options.maxRetries+".",{delay:o.options.retryDelay,retries:o.retryCount,maxretries:o.options.maxRetries})?(l._debugconnect&&console.log("Connection unreachable - retrying stopped by app"),o.onHangup(l.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(l._debugconnect&&console.log("Connection unreachable - retrying ("+o.retryCount+") .."),t.setTimeout(function(){l._connect(o)},o.options.retryDelay)):o.onHangup(l.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case l.CONNECTION_LOST:o.retryCount+=1,o.retryCount<=o.options.maxRetries?o.onHangup(l.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+o.retryCount+"th reconnect to occur in "+o.options.retryDelay/1e3+" second(s).",{delay:o.options.retryDelay,retries:o.retryCount,maxretries:o.options.maxRetries})?(l._debugconnect&&console.log("Connection lost - retrying stopped by app"),o.onHangup(l.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(l._debugconnect&&console.log("Connection lost - retrying ("+o.retryCount+") .."),t.setTimeout(function(){l._connect(o)},o.options.retryDelay)):o.onHangup(l.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},o.options)},l.connect=function(e,n,o,t){var r={};if(r.wsuri=e,r.options=t||{},void 0===r.options.retryDelay&&(r.options.retryDelay=5e3),void 0===r.options.maxRetries&&(r.options.maxRetries=10),void 0===r.options.skipSubprotocolCheck&&(r.options.skipSubprotocolCheck=!1),void 0===r.options.skipSubprotocolAnnounce&&(r.options.skipSubprotocolAnnounce=!1),!n)throw"onConnect handler required!";r.onConnect=n,r.onHangup=o||function(e,n,o){l._debugconnect&&console.log(e,n,o)},r.connects=0,r.retryCount=0,l._connect(r)},l.launch=function(t,r,i){l.connect(t.wsuri,function(o){t.appkey&&""!==t.appkey?o.authreq(t.appkey,t.appextra).then(function(e){var n=null;n="function"==typeof t.appsecret?t.appsecret(e):(n=l.deriveKey(t.appsecret,JSON.parse(e).authextra),o.authsign(e,n)),o.auth(n).then(function(e){r?r(o):l._debugconnect&&o.log("Session opened.")},o.log)},o.log):o.authreq().then(function(){o.auth().then(function(e){r?r(o):l._debugconnect&&o.log("Session opened.")},o.log)},o.log)},function(e,n,o){i?i(e,n,o):l._debugconnect&&l.log("Session closed.",e,n,o)},t.sessionConfig)},l}),ab._UA_FIREFOX=/.*Firefox\/([0-9+]*).*/,ab._UA_CHROME=/.*Chrome\/([0-9+]*).*/,ab._UA_CHROMEFRAME=/.*chromeframe\/([0-9]*).*/,ab._UA_WEBKIT=/.*AppleWebKit\/([0-9+.]*)w*.*/,ab._UA_WEBOS=/.*webOS\/([0-9+.]*)w*.*/,ab._matchRegex=function(e,n){var o=n.exec(e);return o?o[1]:o},ab.lookupWsSupport=function(){var e=navigator.userAgent;if(-1<e.indexOf("MSIE")){if(-1<e.indexOf("MSIE 10"))return[!0,!0,!0];if(-1<e.indexOf("chromeframe")){var n=parseInt(ab._matchRegex(e,ab._UA_CHROMEFRAME));return 14<=n?[!0,!1,!0]:[!1,!1,!1]}if(-1<e.indexOf("MSIE 8")||-1<e.indexOf("MSIE 9"))return[!0,!0,!0]}else{if(-1<e.indexOf("Firefox")){if(n=parseInt(ab._matchRegex(e,ab._UA_FIREFOX))){if(7<=n)return[!0,!1,!0];if(3<=n)return[!0,!0,!0]}return[!1,!1,!0]}if(-1<e.indexOf("Safari")&&-1==e.indexOf("Chrome")){if(n=ab._matchRegex(e,ab._UA_WEBKIT))return-1<e.indexOf("Windows")&&"534+"==n||-1<e.indexOf("Macintosh")&&(n=n.replace("+","").split("."),535==parseInt(n[0])&&24<=parseInt(n[1])||535<parseInt(n[0]))?[!0,!1,!0]:-1<e.indexOf("webOS")?(n=ab._matchRegex(e,ab._UA_WEBOS).split("."),2==parseInt(n[0])?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]}else if(-1<e.indexOf("Chrome")){if(n=parseInt(ab._matchRegex(e,ab._UA_CHROME)))return 14<=n?[!0,!1,!0]:4<=n?[!0,!0,!0]:[!1,!1,!0]}else if(-1<e.indexOf("Android")){if(-1<e.indexOf("Firefox")||-1<e.indexOf("CrMo"))return[!0,!1,!0];if(-1<e.indexOf("Opera"))return[!1,!1,!0];if(-1<e.indexOf("CrMo"))return[!0,!0,!0]}else if(-1<e.indexOf("iPhone")||-1<e.indexOf("iPad")||-1<e.indexOf("iPod"))return[!1,!1,!0]}return[!1,!1,!1]};