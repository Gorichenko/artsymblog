var message_counter={get_message_count:function(t,c){var n=this;$.ajax({type:"GET",url:t,dataType:"json",data:{user_id:c},success:function(t){var a=new Array;if($.each(t,function(t,e){a.push(JSON.stringify(e))}),null==localStorage.getItem("chat_counter_"+c)){var e=a;if(0<e.length)for(var r=0;r<e.length;r++)$("*[data-chat-id="+JSON.parse(e[r]).chat_id+"]").attr("data-difference-count",JSON.parse(e[r]).count).html("<p>"+JSON.parse(e[r]).count+"</p>").css("visibility","visible")}else n.set_count_difference(localStorage.getItem("chat_counter_"+c),a.join(", "))},error:function(){console.log("error")}})},update_message_count:function(t,e){var a=this;setInterval(function(){a.get_message_count(t,e)},1e4)},set_count_difference:function(t,e){var c=t.split(", "),a=e.split(", "),n=new Array;if($.each(a,function(t,a){var r=0;$.each(c,function(t,e){JSON.parse(e).chat_id==JSON.parse(a).chat_id&&r++,JSON.parse(e).chat_id==JSON.parse(a).chat_id&&parseInt(JSON.parse(e).count)!=parseInt(JSON.parse(a).count)&&n.push(JSON.stringify({chat_id:JSON.parse(e).chat_id,difference:parseInt(JSON.parse(a).count)-parseInt(JSON.parse(e).count)}))}),0==r&&n.push(JSON.stringify({chat_id:JSON.parse(a).chat_id,difference:parseInt(JSON.parse(a).count)}))}),0<n.length)for(var r=0;r<n.length;r++)$("*[data-chat-id="+JSON.parse(n[r]).chat_id+"]").attr("data-difference-count",JSON.parse(n[r]).difference).html("<p>"+JSON.parse(n[r]).difference+"</p>").css("visibility","visible");return n},update_storage:function(r,c,n){var s=new Array;if(null!=localStorage.getItem("chat_counter_"+r)){var t=localStorage.getItem("chat_counter_"+r).split(", "),i=0;$.each(t,function(t,e){var a=JSON.parse(e);a.chat_id==c?(i++,$.ajax({type:"GET",async:!1,url:n,dataType:"json",data:{user_id:r,chat_id:c},success:function(t){a.count=t.count,s.push(JSON.stringify(a))},error:function(){console.log("error")}})):s.push(JSON.stringify(a))}),0==i&&$.ajax({type:"GET",async:!1,url:n,dataType:"json",data:{user_id:r,chat_id:c},success:function(t){s.push(JSON.stringify({chat_id:t.chat_id,count:t.count}))},error:function(){console.log("error")}}),localStorage.setItem("chat_counter_"+r,s.join(", "))}else $.ajax({type:"GET",async:!1,url:n,dataType:"json",data:{user_id:r,chat_id:c},success:function(t){var e=new Object;e.chat_id=t.chat_id,e.count=t.count,s.push(JSON.stringify(e)),$("*[data-chat-id="+e.chat_id+"]").html("").css("visibility","hidden")},error:function(){console.log("error")}}),localStorage.setItem("chat_counter_"+r,s.join(", "))}};